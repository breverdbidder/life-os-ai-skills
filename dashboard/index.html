<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life OS - Shapira Family Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --purple: #8b5cf6; --blue: #3b82f6; --green: #10b981; --orange: #f59e0b; --red: #ef4444; }
        body { background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0f172a 100%); min-height: 100vh; font-family: system-ui, -apple-system, sans-serif; }
        .glass { background: rgba(30, 30, 50, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(139, 92, 246, 0.2); }
        .glow { box-shadow: 0 0 25px rgba(139, 92, 246, 0.3); }
        .glow-green { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
        .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .glow-orange { box-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
        .status-badge { padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .driving-animation { animation: drive 3s ease-in-out infinite; }
        @keyframes drive { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(10px); } }
    </style>
</head>
<body class="text-gray-100">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="glass rounded-2xl p-5 mb-6 glow">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="text-5xl">üè†</div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            Life OS - Shapira Family
                        </h1>
                        <p class="text-gray-400 text-sm mt-1">Real-Time Life Tracking ‚Ä¢ ADHD-Optimized</p>
                    </div>
                </div>
                <div class="text-right">
                    <div id="current-date" class="text-lg font-semibold text-purple-400"></div>
                    <div id="current-time" class="text-2xl font-mono text-white"></div>
                    <div id="location" class="text-xs text-gray-500 mt-1">üìç FL: EST | IL: IST</div>
                </div>
            </div>
        </div>

        <!-- Active Trip Banner -->
        <div id="trip-banner" class="glass rounded-xl p-4 mb-6 border-l-4 border-blue-500 glow-blue hidden">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="text-4xl driving-animation">üöó</div>
                    <div>
                        <div class="text-lg font-semibold text-blue-400" id="trip-title">Loading...</div>
                        <div class="text-sm text-gray-400" id="trip-route"></div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-6 text-center">
                    <div>
                        <div class="text-2xl font-bold text-white" id="trip-distance">--</div>
                        <div class="text-xs text-gray-500">MILES</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-white" id="trip-time">--</div>
                        <div class="text-xs text-gray-500">EST. TIME</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-green-400" id="trip-status">--</div>
                        <div class="text-xs text-gray-500">STATUS</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Left Column: Today's Schedule -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Today's Tasks -->
                <div class="glass rounded-xl p-5">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <span>üìã</span> Today's Tasks
                        </h2>
                        <span id="task-count" class="text-sm text-gray-500">0 tasks</span>
                    </div>
                    <div id="tasks-list" class="space-y-3">
                        <div class="text-center text-gray-500 py-4">Loading tasks...</div>
                    </div>
                </div>

                <!-- Michael's Swim Meet -->
                <div class="glass rounded-xl p-5 border-l-4 border-blue-400" id="swim-meet-card">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <span>üèä</span> Michael's Swim Meet
                        </h2>
                        <span class="status-badge bg-blue-900 text-blue-300" id="meet-status">TODAY</span>
                    </div>
                    <div id="swim-meet-details" class="space-y-3">
                        <div class="text-center text-gray-500 py-4">Loading meet info...</div>
                    </div>
                </div>

                <!-- Driving Log -->
                <div class="glass rounded-xl p-5">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <span>üöó</span> Driving Log
                        </h2>
                        <span id="total-miles" class="text-sm text-gray-500">0 miles today</span>
                    </div>
                    <div id="driving-log" class="space-y-3">
                        <div class="text-center text-gray-500 py-4">Loading trips...</div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Quick Info -->
            <div class="space-y-6">
                <!-- Family Members -->
                <div class="glass rounded-xl p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <span>üë®‚Äçüë©‚Äçüë¶</span> Family Status
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-purple-900/30 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üë§</div>
                                <div>
                                    <div class="font-medium">Ariel</div>
                                    <div class="text-xs text-gray-400" id="ariel-status">Traveling to Ocala</div>
                                </div>
                            </div>
                            <div class="text-green-400 text-sm">üöó</div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-blue-900/30 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üèä</div>
                                <div>
                                    <div class="font-medium">Michael</div>
                                    <div class="text-xs text-gray-400" id="michael-status">Swim Meet - Ocala</div>
                                </div>
                            </div>
                            <div class="text-blue-400 text-sm">üèÜ</div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-900/30 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üë©</div>
                                <div>
                                    <div class="font-medium">Mariam</div>
                                    <div class="text-xs text-gray-400">Home - Satellite Beach</div>
                                </div>
                            </div>
                            <div class="text-green-400 text-sm">üè†</div>
                        </div>
                    </div>
                </div>

                <!-- Hotel Reservation -->
                <div class="glass rounded-xl p-5 border-l-4 border-orange-400" id="hotel-card">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <span>üè®</span> Hotel Tonight
                    </h2>
                    <div id="hotel-details">
                        <div class="text-center text-gray-500 py-4">Loading...</div>
                    </div>
                </div>

                <!-- Michael's Nutrition -->
                <div class="glass rounded-xl p-5 border-l-4 border-green-400">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <span>ü•ó</span> Michael's Nutrition
                    </h2>
                    <div id="nutrition-details">
                        <div class="text-center text-gray-500 py-4">Loading...</div>
                    </div>
                </div>

                <!-- Home Base -->
                <div class="glass rounded-xl p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <span>üè†</span> Home Base
                    </h2>
                    <div class="text-sm">
                        <div class="text-gray-400">390 Roosevelt Ave</div>
                        <div class="text-white font-medium">Satellite Beach, FL 32937</div>
                        <div class="mt-3 flex items-center gap-2 text-xs text-gray-500">
                            <span>üå¥</span> Brevard County
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-purple-400" id="stat-tasks">0</div>
                <div class="text-xs text-gray-500 uppercase">Tasks Today</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-blue-400" id="stat-miles">0</div>
                <div class="text-xs text-gray-500 uppercase">Miles Today</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-green-400" id="stat-events">0</div>
                <div class="text-xs text-gray-500 uppercase">Events</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-orange-400" id="stat-focus">--</div>
                <div class="text-xs text-gray-500 uppercase">Focus Score</div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-xs">
            <p>Life OS v2.0 ‚Ä¢ Created by Ariel Shapira ‚Ä¢ Auto-refreshes every 30s</p>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://mocerqjnksmhcjzxrewo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vY2VycWpua3NtaGNqenhyZXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MzI1MjYsImV4cCI6MjA4MDEwODUyNn0.ySFJIOngWWB0aqYra4PoGFuqcbdHOx1ZV6T9-klKQDw';
        
        const headers = {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Content-Type': 'application/json'
        };

        // Update time display
        function updateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        setInterval(updateTime, 1000);
        updateTime();

        async function fetchData() {
            try {
                // Get today's date
                const today = new Date().toISOString().split('T')[0];
                
                // Fetch all activities for today
                const res = await fetch(
                    `${SUPABASE_URL}/rest/v1/activities?platform=eq.life_os&order=start_time.desc`,
                    { headers }
                );
                const activities = await res.json();
                
                let totalMiles = 0;
                let taskCount = 0;
                let eventCount = 0;
                let focusSum = 0;
                let focusCount = 0;
                
                const tasks = [];
                const trips = [];
                let activeTrip = null;
                let swimMeet = null;
                let hotel = null;
                let nutrition = null;
                
                activities.forEach(a => {
                    try {
                        const data = JSON.parse(a.notes || '{}');
                        
                        if (a.activity_type === 'DRIVING') {
                            const trip = { ...a, ...data };
                            trips.push(trip);
                            totalMiles += data.distance_miles || 0;
                            if (data.status === 'in_progress') activeTrip = trip;
                        }
                        else if (a.activity_type === 'TASK') {
                            tasks.push({ ...a, ...data });
                            taskCount++;
                        }
                        else if (a.activity_type === 'SWIM_MEET') {
                            swimMeet = { ...a, ...data };
                            eventCount++;
                        }
                        else if (a.activity_type === 'HOTEL') {
                            hotel = { ...a, ...data };
                        }
                        else if (a.activity_type === 'NUTRITION') {
                            nutrition = { ...a, ...data };
                        }
                        
                        if (a.focus_quality) {
                            focusSum += a.focus_quality;
                            focusCount++;
                        }
                    } catch(e) {}
                });
                
                // Update stats
                document.getElementById('stat-tasks').textContent = taskCount;
                document.getElementById('stat-miles').textContent = totalMiles;
                document.getElementById('stat-events').textContent = eventCount;
                document.getElementById('stat-focus').textContent = focusCount > 0 ? Math.round(focusSum / focusCount) : '--';
                document.getElementById('task-count').textContent = `${taskCount} tasks`;
                document.getElementById('total-miles').textContent = `${totalMiles} miles today`;
                
                // Render active trip banner
                if (activeTrip) {
                    document.getElementById('trip-banner').classList.remove('hidden');
                    document.getElementById('trip-title').textContent = activeTrip.title || 'Active Trip';
                    document.getElementById('trip-route').textContent = `${activeTrip.origin || 'Origin'} ‚Üí ${activeTrip.destination || 'Destination'}`;
                    document.getElementById('trip-distance').textContent = activeTrip.distance_miles || '--';
                    const hours = Math.floor((activeTrip.estimated_time_minutes || 0) / 60);
                    const mins = (activeTrip.estimated_time_minutes || 0) % 60;
                    document.getElementById('trip-time').textContent = `${hours}h ${mins}m`;
                    document.getElementById('trip-status').textContent = 'IN PROGRESS';
                }
                
                // Render tasks
                const tasksHtml = tasks.length > 0 ? tasks.map(t => {
                    const statusColors = {
                        'completed': 'bg-green-900/50 text-green-300',
                        'in_progress': 'bg-blue-900/50 text-blue-300',
                        'pending': 'bg-gray-700 text-gray-300'
                    };
                    const statusIcons = {
                        'completed': '‚úÖ',
                        'in_progress': 'üîÑ',
                        'pending': '‚è≥'
                    };
                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <span class="text-xl">${statusIcons[t.status] || 'üìå'}</span>
                                <div>
                                    <div class="font-medium">${t.title || 'Task'}</div>
                                    <div class="text-xs text-gray-500">${t.description || ''}</div>
                                </div>
                            </div>
                            <span class="status-badge ${statusColors[t.status] || 'bg-gray-700 text-gray-300'}">${(t.status || 'pending').toUpperCase()}</span>
                        </div>
                    `;
                }).join('') : '<div class="text-center text-gray-500 py-4">No tasks for today</div>';
                document.getElementById('tasks-list').innerHTML = tasksHtml;
                
                // Render swim meet
                if (swimMeet) {
                    const events = swimMeet.events || [];
                    document.getElementById('swim-meet-details').innerHTML = `
                        <div class="mb-3">
                            <div class="text-lg font-semibold text-white">${swimMeet.meet_name || 'Swim Meet'}</div>
                            <div class="text-sm text-gray-400">üìç ${swimMeet.location || 'TBD'}</div>
                            <div class="text-sm text-gray-400">üè´ ${swimMeet.school || ''}</div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 mb-3">
                            ${events.map(e => `
                                <div class="bg-blue-900/30 rounded-lg p-2 text-center">
                                    <div class="font-semibold text-blue-300">${e.event}</div>
                                    <div class="text-xs text-gray-400">Seed: ${e.seed_time || 'NT'}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">üçΩÔ∏è ${swimMeet.diet_today || 'Standard'}</span>
                            <span class="text-gray-400">‚è∞ Warmup: ${swimMeet.warmup_time || 'TBD'}</span>
                        </div>
                    `;
                }
                
                // Render hotel
                if (hotel) {
                    document.getElementById('hotel-details').innerHTML = `
                        <div class="space-y-2">
                            <div class="font-semibold text-orange-300">${hotel.hotel_name || 'Hotel TBD'}</div>
                            <div class="text-sm text-gray-400">üìç ${hotel.address || 'Address TBD'}</div>
                            <div class="flex justify-between text-sm mt-3">
                                <div><span class="text-gray-500">Check-in:</span> <span class="text-white">${hotel.check_in || 'TBD'}</span></div>
                            </div>
                            <div class="flex justify-between text-sm">
                                <div><span class="text-gray-500">Check-out:</span> <span class="text-white">${hotel.check_out || 'TBD'}</span></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2">üë• ${(hotel.guests || []).join(', ')}</div>
                        </div>
                    `;
                }
                
                // Render nutrition
                if (nutrition) {
                    document.getElementById('nutrition-details').innerHTML = `
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <span class="text-green-400 font-medium">${nutrition.diet_phase?.toUpperCase() || 'STANDARD'}</span>
                                <span class="text-xs text-gray-500">${nutrition.meal_type || ''}</span>
                            </div>
                            <div class="text-sm text-gray-400">${(nutrition.foods || []).join(', ')}</div>
                            <div class="grid grid-cols-3 gap-2 mt-3 text-center text-xs">
                                <div class="bg-gray-800 rounded p-2">
                                    <div class="text-white font-bold">${nutrition.total_calories || 0}</div>
                                    <div class="text-gray-500">Cal</div>
                                </div>
                                <div class="bg-gray-800 rounded p-2">
                                    <div class="text-white font-bold">${nutrition.total_protein_g || 0}g</div>
                                    <div class="text-gray-500">Protein</div>
                                </div>
                                <div class="bg-gray-800 rounded p-2">
                                    <div class="text-white font-bold">${nutrition.total_carbs_g || 0}g</div>
                                    <div class="text-gray-500">Carbs</div>
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2">${nutrition.note || ''}</div>
                        </div>
                    `;
                }
                
                // Render driving log
                const drivingHtml = trips.length > 0 ? trips.map(t => `
                    <div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">${t.status === 'in_progress' ? 'üöó' : '‚úÖ'}</span>
                            <div>
                                <div class="font-medium">${t.title || 'Trip'}</div>
                                <div class="text-xs text-gray-500">${t.origin || ''} ‚Üí ${t.destination || ''}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-blue-400">${t.distance_miles || 0} mi</div>
                            <div class="text-xs text-gray-500">${Math.floor((t.estimated_time_minutes || 0) / 60)}h ${(t.estimated_time_minutes || 0) % 60}m</div>
                        </div>
                    </div>
                `).join('') : '<div class="text-center text-gray-500 py-4">No trips logged today</div>';
                document.getElementById('driving-log').innerHTML = drivingHtml;
                
            } catch(e) {
                console.error('Fetch error:', e);
            }
        }

        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
