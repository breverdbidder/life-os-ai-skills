<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life OS AI Skills Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --life-purple: #8b5cf6; 
            --life-blue: #3b82f6; 
            --life-green: #10b981;
            --life-orange: #f59e0b;
        }
        body { 
            background: linear-gradient(135deg, #0f0f1a 0%, #1e1b4b 50%, #0f0f1a 100%); 
            min-height: 100vh; 
        }
        .glass { 
            background: rgba(30, 27, 75, 0.6); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(139, 92, 246, 0.2); 
        }
        .glow { box-shadow: 0 0 25px rgba(139, 92, 246, 0.4); }
        .life-text { 
            background: linear-gradient(90deg, var(--life-purple), var(--life-blue), var(--life-green)); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }
        .domain-business { border-left: 4px solid var(--life-blue); }
        .domain-michael { border-left: 4px solid var(--life-green); }
        .domain-family { border-left: 4px solid var(--life-orange); }
        .domain-personal { border-left: 4px solid var(--life-purple); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="text-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-8 glow">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold life-text">Life OS AI Skills System</h1>
                    <p class="text-gray-400 mt-1">ADHD-Optimized Productivity Intelligence ‚Ä¢ v2.0.0</p>
                    <div class="flex gap-2 mt-3">
                        <span class="px-2 py-1 bg-blue-900/50 text-blue-300 rounded text-xs border border-blue-700">BUSINESS</span>
                        <span class="px-2 py-1 bg-green-900/50 text-green-300 rounded text-xs border border-green-700">MICHAEL</span>
                        <span class="px-2 py-1 bg-orange-900/50 text-orange-300 rounded text-xs border border-orange-700">FAMILY</span>
                        <span class="px-2 py-1 bg-purple-900/50 text-purple-300 rounded text-xs border border-purple-700">PERSONAL</span>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Last Updated</div>
                    <div id="last-update" class="text-purple-400 font-mono">Loading...</div>
                    <div id="status" class="text-xs text-green-400 mt-1">‚óè Connected</div>
                </div>
            </div>
        </div>

        <!-- Domain Stats -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass rounded-xl p-4 domain-business">
                <p class="text-blue-400 text-xs uppercase tracking-wide">Business</p>
                <p id="business-skills" class="text-2xl font-bold text-white mt-1">-</p>
                <p class="text-gray-500 text-xs">skills</p>
            </div>
            <div class="glass rounded-xl p-4 domain-michael">
                <p class="text-green-400 text-xs uppercase tracking-wide">Michael D1</p>
                <p id="michael-skills" class="text-2xl font-bold text-white mt-1">-</p>
                <p class="text-gray-500 text-xs">skills</p>
            </div>
            <div class="glass rounded-xl p-4 domain-family">
                <p class="text-orange-400 text-xs uppercase tracking-wide">Family</p>
                <p id="family-skills" class="text-2xl font-bold text-white mt-1">-</p>
                <p class="text-gray-500 text-xs">skills</p>
            </div>
            <div class="glass rounded-xl p-4 domain-personal">
                <p class="text-purple-400 text-xs uppercase tracking-wide">Personal</p>
                <p id="personal-skills" class="text-2xl font-bold text-white mt-1">-</p>
                <p class="text-gray-500 text-xs">skills</p>
            </div>
        </div>

        <!-- Main Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Total Skills</p>
                        <p id="total-skills" class="text-4xl font-bold life-text mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">üß†</div>
                </div>
            </div>
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Success Rate</p>
                        <p id="success-rate" class="text-4xl font-bold text-green-400 mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">‚úÖ</div>
                </div>
                <div class="mt-3 h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div id="success-bar" class="h-full bg-gradient-to-r from-purple-500 to-blue-400 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Time Saved</p>
                        <p id="time-saved" class="text-4xl font-bold text-purple-400 mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">‚è±Ô∏è</div>
                </div>
            </div>
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Tasks Tracked</p>
                        <p id="total-tasks" class="text-4xl font-bold text-orange-400 mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">üìã</div>
                </div>
            </div>
        </div>

        <!-- ADHD Metrics -->
        <div class="glass rounded-xl p-6 mb-8">
            <h2 class="text-xl font-semibold life-text mb-4">üìä ADHD Performance Metrics</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <p class="text-3xl font-bold text-green-400" id="completion-rate">-</p>
                    <p class="text-gray-400 text-sm mt-1">Completion Rate</p>
                </div>
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <p class="text-3xl font-bold text-yellow-400" id="abandonment-rate">-</p>
                    <p class="text-gray-400 text-sm mt-1">Abandonment Rate</p>
                </div>
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <p class="text-3xl font-bold text-blue-400" id="avg-focus">-</p>
                    <p class="text-gray-400 text-sm mt-1">Avg Focus Quality</p>
                </div>
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <p class="text-3xl font-bold text-purple-400" id="streak-days">-</p>
                    <p class="text-gray-400 text-sm mt-1">Current Streak</p>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="glass rounded-xl p-6">
                <h2 class="text-xl font-semibold life-text mb-4">Skills by Domain</h2>
                <div class="h-64"><canvas id="domainChart"></canvas></div>
            </div>
            <div class="glass rounded-xl p-6">
                <h2 class="text-xl font-semibold life-text mb-4">Weekly Activity</h2>
                <div class="h-64"><canvas id="activityChart"></canvas></div>
            </div>
        </div>

        <!-- Skills Table -->
        <div class="glass rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between mb-4 flex-wrap gap-4">
                <h2 class="text-xl font-semibold life-text">Life OS Skills Inventory</h2>
                <div class="flex gap-2">
                    <select id="domain-filter" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm focus:border-purple-400 focus:outline-none">
                        <option value="">All Domains</option>
                        <option value="BUSINESS">Business</option>
                        <option value="MICHAEL">Michael D1</option>
                        <option value="FAMILY">Family</option>
                        <option value="PERSONAL">Personal</option>
                    </select>
                    <input type="text" id="search" placeholder="Search skills..." 
                        class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-sm focus:border-purple-400 focus:outline-none">
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left text-gray-400 text-sm border-b border-gray-700">
                            <th class="pb-3 font-medium">Skill Name</th>
                            <th class="pb-3 font-medium">Domain</th>
                            <th class="pb-3 font-medium">Category</th>
                            <th class="pb-3 font-medium">Uses</th>
                            <th class="pb-3 font-medium">Success</th>
                            <th class="pb-3 font-medium">Time Saved</th>
                            <th class="pb-3 font-medium">Status</th>
                        </tr>
                    </thead>
                    <tbody id="skills-table"></tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-sm">
            <p>Created by <span class="text-purple-400">Ariel Shapira</span> ‚Ä¢ Life OS for ADHD Optimization</p>
            <p class="mt-1">Life OS v2.0.0 | AI Skills System v2.0.0</p>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://mocerqjnksmhcjzxrewo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vY2VycWpua3NtaGNqenhyZXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MzI1MjYsImV4cCI6MjA4MDEwODUyNn0.ySFJIOngWWB0aqYra4PoGFuqcbdHOx1ZV6T9-klKQDw';
        
        const headers = {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Content-Type': 'application/json'
        };

        let domainChart, activityChart;
        const domainColors = {
            'BUSINESS': '#3b82f6',
            'MICHAEL': '#10b981', 
            'FAMILY': '#f59e0b',
            'PERSONAL': '#8b5cf6'
        };

        async function fetchData() {
            try {
                document.getElementById('status').innerHTML = '‚óè Fetching...';
                document.getElementById('status').className = 'text-xs text-yellow-400 mt-1 pulse';
                
                // Fetch Life OS skills from insights
                const skillsRes = await fetch(`${SUPABASE_URL}/rest/v1/insights?insight_type=eq.life_os_skill&status=eq.Active`, { headers });
                const skills = await skillsRes.json();
                
                // Fetch activities for task count and ADHD metrics
                const activitiesRes = await fetch(`${SUPABASE_URL}/rest/v1/activities?activity_type=eq.life_os_task&select=id,notes,focus_quality,domain&order=created_at.desc&limit=100`, { headers });
                const activities = await activitiesRes.json();
                
                // Fetch daily metrics for trends
                const metricsRes = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?select=*&order=date.desc&limit=7`, { headers });
                const dailyMetrics = await metricsRes.json();
                
                // Calculate metrics
                let totalUses = 0, totalTimeSaved = 0, totalSuccess = 0;
                const domainCount = { BUSINESS: 0, MICHAEL: 0, FAMILY: 0, PERSONAL: 0 };
                const skillsData = [];
                
                skills.forEach(s => {
                    try {
                        const data = JSON.parse(s.action_taken || '{}');
                        const uses = data.total_uses || s.recurrence_count || 0;
                        const timeSaved = (data.avg_time_saved || 0) * uses;
                        const successRate = s.confidence || 0;
                        const domain = data.domain || 'PERSONAL';
                        const category = data.category || 'productivity';
                        
                        totalUses += uses;
                        totalTimeSaved += timeSaved;
                        totalSuccess += successRate;
                        domainCount[domain] = (domainCount[domain] || 0) + 1;
                        
                        skillsData.push({
                            name: s.title,
                            domain,
                            category,
                            uses,
                            successRate: (successRate * 100).toFixed(0) + '%',
                            successValue: successRate * 100,
                            timeSaved: timeSaved.toFixed(0) + 'm',
                            timeSavedValue: timeSaved,
                            status: successRate >= 0.8 ? 'Optimal' : successRate >= 0.6 ? 'Review' : 'Needs Work'
                        });
                    } catch(e) {}
                });
                
                const avgSuccess = skills.length > 0 ? (totalSuccess / skills.length) : 0;
                
                // Calculate ADHD metrics from activities
                const avgFocus = activities.length > 0 
                    ? activities.reduce((sum, a) => sum + (a.focus_quality || 5), 0) / activities.length 
                    : 0;
                
                // Update UI
                document.getElementById('total-skills').textContent = skills.length;
                document.getElementById('success-rate').textContent = (avgSuccess * 100).toFixed(0) + '%';
                document.getElementById('success-bar').style.width = (avgSuccess * 100) + '%';
                document.getElementById('time-saved').textContent = (totalTimeSaved / 60).toFixed(1) + 'h';
                document.getElementById('total-tasks').textContent = activities.length;
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                document.getElementById('status').innerHTML = '‚óè Connected';
                document.getElementById('status').className = 'text-xs text-green-400 mt-1';
                
                // Domain counts
                document.getElementById('business-skills').textContent = domainCount.BUSINESS;
                document.getElementById('michael-skills').textContent = domainCount.MICHAEL;
                document.getElementById('family-skills').textContent = domainCount.FAMILY;
                document.getElementById('personal-skills').textContent = domainCount.PERSONAL;
                
                // ADHD metrics
                document.getElementById('completion-rate').textContent = (avgSuccess * 100).toFixed(0) + '%';
                document.getElementById('abandonment-rate').textContent = ((1 - avgSuccess) * 100).toFixed(0) + '%';
                document.getElementById('avg-focus').textContent = avgFocus.toFixed(1) + '/10';
                document.getElementById('streak-days').textContent = dailyMetrics.length > 0 ? dailyMetrics.length : '0';
                
                // Update table
                updateTable(skillsData);
                updateCharts(domainCount, skillsData, dailyMetrics);
                
            } catch(e) {
                console.error('Fetch error:', e);
                document.getElementById('status').innerHTML = '‚óè Error';
                document.getElementById('status').className = 'text-xs text-red-400 mt-1';
            }
        }

        function updateTable(skillsData) {
            const domainFilter = document.getElementById('domain-filter').value;
            const searchTerm = document.getElementById('search').value.toLowerCase();
            
            const filtered = skillsData.filter(s => {
                const matchesDomain = !domainFilter || s.domain === domainFilter;
                const matchesSearch = s.name.toLowerCase().includes(searchTerm) || s.category.toLowerCase().includes(searchTerm);
                return matchesDomain && matchesSearch;
            });
            
            const tbody = document.getElementById('skills-table');
            tbody.innerHTML = filtered.map(s => `
                <tr class="border-b border-gray-800 hover:bg-gray-800/50 transition-colors">
                    <td class="py-3 font-medium">${s.name}</td>
                    <td class="py-3">
                        <span class="px-2 py-1 rounded text-xs font-medium" style="background: ${domainColors[s.domain]}20; color: ${domainColors[s.domain]}; border: 1px solid ${domainColors[s.domain]}50">
                            ${s.domain}
                        </span>
                    </td>
                    <td class="py-3"><span class="px-2 py-1 bg-gray-700 rounded text-xs">${s.category}</span></td>
                    <td class="py-3 font-mono">${s.uses}</td>
                    <td class="py-3 font-mono ${s.successValue >= 80 ? 'text-green-400' : s.successValue >= 60 ? 'text-yellow-400' : 'text-red-400'}">${s.successRate}</td>
                    <td class="py-3 font-mono text-purple-400">${s.timeSaved}</td>
                    <td class="py-3">
                        <span class="px-2 py-1 rounded text-xs font-medium ${
                            s.status === 'Optimal' ? 'bg-green-900/50 text-green-300 border border-green-700' :
                            s.status === 'Review' ? 'bg-yellow-900/50 text-yellow-300 border border-yellow-700' :
                            'bg-red-900/50 text-red-300 border border-red-700'
                        }">${s.status}</span>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="7" class="py-8 text-center text-gray-500">No skills found. Start tracking tasks!</td></tr>';
        }

        function updateCharts(domains, skills, metrics) {
            // Domain chart
            if (domainChart) domainChart.destroy();
            domainChart = new Chart(document.getElementById('domainChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(domains),
                    datasets: [{
                        data: Object.values(domains),
                        backgroundColor: Object.values(domainColors),
                        borderWidth: 0
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'right', labels: { color: '#9ca3af', padding: 15 } } }
                }
            });
            
            // Activity chart
            if (activityChart) activityChart.destroy();
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            activityChart = new Chart(document.getElementById('activityChart'), {
                type: 'bar',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Focus Quality',
                        data: metrics.slice(0, 7).reverse().map(m => m.avg_focus_quality || 5),
                        backgroundColor: 'rgba(139, 92, 246, 0.7)',
                        borderColor: '#8b5cf6',
                        borderWidth: 1
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#9ca3af' } } },
                    scales: { 
                        y: { grid: { color: 'rgba(55, 65, 81, 0.5)' }, ticks: { color: '#9ca3af' }, max: 10 },
                        x: { grid: { color: 'rgba(55, 65, 81, 0.5)' }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
        }

        // Event listeners
        document.getElementById('search').addEventListener('input', fetchData);
        document.getElementById('domain-filter').addEventListener('change', fetchData);

        // Initial load and refresh
        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
