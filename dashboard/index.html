<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life OS - AI Skills Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --purple: #8b5cf6; --blue: #3b82f6; --green: #10b981; }
        body { background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0f172a 100%); min-height: 100vh; font-family: system-ui, -apple-system, sans-serif; }
        .glass { background: rgba(30, 30, 50, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(139, 92, 246, 0.2); }
        .glow { box-shadow: 0 0 25px rgba(139, 92, 246, 0.3); }
    </style>
</head>
<body class="text-gray-100">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="glass rounded-2xl p-5 mb-6 glow">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="text-5xl">üß†</div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            Life OS - AI Skills Dashboard
                        </h1>
                        <p class="text-gray-400 text-sm mt-1">Pattern Recognition ‚Ä¢ Skill Development ‚Ä¢ ADHD Optimization</p>
                    </div>
                </div>
                <div class="text-right">
                    <div id="status" class="text-sm text-green-400">‚óè Connected</div>
                    <div class="text-xs text-gray-500">Auto-refresh: 30s</div>
                </div>
            </div>
        </div>

        <!-- Domain Quick Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="glass rounded-xl p-4 text-center border-l-4 border-purple-500">
                <div class="text-2xl mb-1">üë§</div>
                <div class="text-2xl font-bold text-purple-400" id="ariel-count">0</div>
                <div class="text-xs text-gray-500">ARIEL</div>
            </div>
            <div class="glass rounded-xl p-4 text-center border-l-4 border-blue-500">
                <div class="text-2xl mb-1">üèä</div>
                <div class="text-2xl font-bold text-blue-400" id="michael-count">0</div>
                <div class="text-xs text-gray-500">MICHAEL</div>
            </div>
            <div class="glass rounded-xl p-4 text-center border-l-4 border-green-500">
                <div class="text-2xl mb-1">üë®‚Äçüë©‚Äçüë¶</div>
                <div class="text-2xl font-bold text-green-400" id="family-count">0</div>
                <div class="text-xs text-gray-500">FAMILY</div>
            </div>
            <div class="glass rounded-xl p-4 text-center border-l-4 border-orange-500">
                <div class="text-2xl mb-1">üíº</div>
                <div class="text-2xl font-bold text-orange-400" id="business-count">0</div>
                <div class="text-xs text-gray-500">BUSINESS</div>
            </div>
        </div>

        <!-- Main Metrics -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="glass rounded-xl p-5 text-center">
                <div class="text-4xl font-bold text-white" id="total-skills">0</div>
                <div class="text-sm text-gray-400">Total Skills</div>
            </div>
            <div class="glass rounded-xl p-5 text-center">
                <div class="text-4xl font-bold text-green-400" id="adhd-effectiveness">0%</div>
                <div class="text-sm text-gray-400">ADHD Effectiveness</div>
            </div>
            <div class="glass rounded-xl p-5 text-center">
                <div class="text-4xl font-bold text-blue-400" id="time-saved">0h</div>
                <div class="text-sm text-gray-400">Time Saved</div>
            </div>
            <div class="glass rounded-xl p-5 text-center">
                <div class="text-4xl font-bold text-purple-400" id="tasks-documented">0</div>
                <div class="text-sm text-gray-400">Tasks Documented</div>
            </div>
        </div>

        <!-- Skills Table -->
        <div class="glass rounded-xl p-5 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold">üß† Skills Inventory</h2>
                <div class="flex gap-2" id="domain-filters">
                    <button onclick="filterDomain('all')" class="px-3 py-1 rounded-lg bg-gray-700 text-sm hover:bg-gray-600">All</button>
                    <button onclick="filterDomain('ARIEL')" class="px-3 py-1 rounded-lg bg-purple-900/50 text-sm hover:bg-purple-800/50">Ariel</button>
                    <button onclick="filterDomain('MICHAEL')" class="px-3 py-1 rounded-lg bg-blue-900/50 text-sm hover:bg-blue-800/50">Michael</button>
                    <button onclick="filterDomain('FAMILY')" class="px-3 py-1 rounded-lg bg-green-900/50 text-sm hover:bg-green-800/50">Family</button>
                    <button onclick="filterDomain('BUSINESS')" class="px-3 py-1 rounded-lg bg-orange-900/50 text-sm hover:bg-orange-800/50">Business</button>
                </div>
            </div>
            <div id="skills-table" class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="text-gray-400 border-b border-gray-700">
                            <th class="text-left py-2 px-3">Skill</th>
                            <th class="text-left py-2 px-3">Domain</th>
                            <th class="text-left py-2 px-3">Category</th>
                            <th class="text-center py-2 px-3">Uses</th>
                            <th class="text-center py-2 px-3">ADHD Score</th>
                            <th class="text-center py-2 px-3">Status</th>
                        </tr>
                    </thead>
                    <tbody id="skills-body">
                        <tr><td colspan="6" class="text-center py-8 text-gray-500">Loading skills...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-xs">
            <p>Life OS AI Skills v1.0 ‚Ä¢ Created by Ariel Shapira</p>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://mocerqjnksmhcjzxrewo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vY2VycWpua3NtaGNqenhyZXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MzI1MjYsImV4cCI6MjA4MDEwODUyNn0.ySFJIOngWWB0aqYra4PoGFuqcbdHOx1ZV6T9-klKQDw';
        
        const headers = {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Content-Type': 'application/json'
        };

        let allSkills = [];
        let currentFilter = 'all';

        function filterDomain(domain) {
            currentFilter = domain;
            renderSkills();
        }

        function renderSkills() {
            const filtered = currentFilter === 'all' ? allSkills : allSkills.filter(s => s.domain === currentFilter);
            
            const tbody = document.getElementById('skills-body');
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No skills found</td></tr>';
                return;
            }

            const domainColors = {
                'ARIEL': 'text-purple-400',
                'MICHAEL': 'text-blue-400',
                'FAMILY': 'text-green-400',
                'BUSINESS': 'text-orange-400'
            };

            tbody.innerHTML = filtered.map(s => {
                const adhdScore = s.adhd_effectiveness || 0;
                const adhdClass = adhdScore >= 90 ? 'text-green-400' : adhdScore >= 70 ? 'text-yellow-400' : 'text-red-400';
                
                return `
                    <tr class="border-b border-gray-800 hover:bg-gray-800/50">
                        <td class="py-3 px-3 font-medium">${s.name || s.title}</td>
                        <td class="py-3 px-3 ${domainColors[s.domain] || 'text-gray-400'}">${s.domain}</td>
                        <td class="py-3 px-3 text-gray-400">${s.category}</td>
                        <td class="py-3 px-3 text-center">${s.total_uses || 0}</td>
                        <td class="py-3 px-3 text-center ${adhdClass}">${adhdScore}%</td>
                        <td class="py-3 px-3 text-center"><span class="px-2 py-1 rounded text-xs bg-green-900/50 text-green-300">Active</span></td>
                    </tr>
                `;
            }).join('');
        }

        async function fetchData() {
            try {
                const res = await fetch(
                    `${SUPABASE_URL}/rest/v1/insights?insight_type=eq.lifeos_ai_skill&status=eq.Active`,
                    { headers }
                );
                const skills = await res.json();
                allSkills = skills.map(s => {
                    try {
                        const content = JSON.parse(s.content || '{}');
                        return { ...s, ...content };
                    } catch { return s; }
                });

                // Update counts
                const domains = { ARIEL: 0, MICHAEL: 0, FAMILY: 0, BUSINESS: 0 };
                let totalUses = 0;
                let totalTimeSaved = 0;
                let adhdSum = 0;

                allSkills.forEach(s => {
                    if (domains[s.domain] !== undefined) domains[s.domain]++;
                    totalUses += s.total_uses || 0;
                    totalTimeSaved += (s.total_uses || 0) * (s.avg_time_saved || 0);
                    adhdSum += s.adhd_effectiveness || 0;
                });

                document.getElementById('ariel-count').textContent = domains.ARIEL;
                document.getElementById('michael-count').textContent = domains.MICHAEL;
                document.getElementById('family-count').textContent = domains.FAMILY;
                document.getElementById('business-count').textContent = domains.BUSINESS;
                document.getElementById('total-skills').textContent = allSkills.length;
                document.getElementById('adhd-effectiveness').textContent = allSkills.length > 0 ? Math.round(adhdSum / allSkills.length) + '%' : '0%';
                document.getElementById('time-saved').textContent = Math.round(totalTimeSaved / 60) + 'h';

                // Get tasks count
                const tasksRes = await fetch(
                    `${SUPABASE_URL}/rest/v1/activities?activity_type=eq.lifeos_skill_task&select=id`,
                    { headers }
                );
                const tasks = await tasksRes.json();
                document.getElementById('tasks-documented').textContent = tasks.length;

                renderSkills();
            } catch(e) {
                console.error('Fetch error:', e);
            }
        }

        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
